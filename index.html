<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çé¦™å°é¤¨ - ç·šä¸Šè¨‚é¤</title>
    <!-- Load Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Firebase SDKs for Auth and Firestore -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // setLogLevel('Debug'); // å–æ¶ˆè¨»é‡‹æ­¤è¡Œå¯æŸ¥çœ‹ Firebase è©³ç´°æ—¥èªŒ

        // --- ğŸš¨ æ­¥é©Ÿä¸€ï¼šè«‹åœ¨é€™è£¡è²¼ä¸Šæ‚¨è‡ªå·±çš„ Firebase è¨­å®š ğŸš¨ ---
        // è«‹å‹™å¿…å¾æ‚¨çš„ Firebase å°ˆæ¡ˆè¨­å®šä¸­å–å¾—ä»¥ä¸‹é‡‘é‘°ã€‚
        // å¦‚æœæ‚¨åœ¨ GitHub Pages ä¸Šé‹è¡Œä½†æœªå¡«å¯«æ­¤è™•ï¼Œç¶²é å°‡é€²å…¥ã€Œé›¢ç·šæ¨¡å¼ã€ï¼Œä½† LINE å‚³é€åŠŸèƒ½ä»å¯ä½¿ç”¨ã€‚
        const YOUR_FIREBASE_CONFIG = {
            apiKey: null, // <-- è«‹è²¼ä¸Šæ‚¨çš„ apiKey (ä¾‹å¦‚: "AIzaSyC...")
            authDomain: null, // <-- è«‹è²¼ä¸Šæ‚¨çš„ authDomain (ä¾‹å¦‚: "your-project-id.firebaseapp.com")
            projectId: null, // <-- è«‹è²¼ä¸Šæ‚¨çš„ projectId (ä¾‹å¦‚: "your-project-id")
            storageBucket: null,
            messagingSenderId: null,
            appId: null,
            measurementId: null
        };
        // --------------------------------------------------------

        // --- GLOBAL SETUP ---
        window.app = null;
        window.db = null;
        window.auth = null;
        window.currentUserId = null;
        window.isFirebaseReady = false; // è¿½è¹¤ Firebase æ˜¯å¦æˆåŠŸåˆå§‹åŒ–
        // åœ¨å…¬é–‹éƒ¨ç½²æ™‚ï¼Œä½¿ç”¨å°ˆæ¡ˆ ID ä½œç‚º app ID
        window.appId = YOUR_FIREBASE_CONFIG.projectId || 'default-github-page-app'; 

        /**
         * Initializes Firebase services and authenticates the user.
         */
        async function initializeFirebase() {
            // æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦å·²å¡«å¯«é…ç½®ï¼Œä¸¦ç§»é™¤ null å€¼é¿å…åˆå§‹åŒ–éŒ¯èª¤
            const cleanConfig = Object.fromEntries(
                Object.entries(YOUR_FIREBASE_CONFIG).filter(([_, v]) => v !== null)
            );
            const hasUserConfig = cleanConfig.apiKey && cleanConfig.projectId;

            if (!hasUserConfig) {
                console.warn("Firebase è¨­å®šæª”éºå¤±æˆ–æœªå¡«å¯«ã€‚é›²ç«¯è¨‚å–®å‚™ä»½åŠŸèƒ½å·²åœç”¨ (é›¢ç·šæ¨¡å¼)ã€‚");
                document.getElementById('user-info').textContent = 'ç”¨æˆ¶ID: é›¢ç·šæ¨¡å¼ (è«‹å¡«å¯«é…ç½®)';
                return; // åœæ­¢åˆå§‹åŒ–ï¼Œé¿å…éŒ¯èª¤
            }
            
            // --- æ­£å¸¸åˆå§‹åŒ–æµç¨‹ (ä½¿ç”¨ç”¨æˆ¶çš„é…ç½®) ---
            try {
                window.app = initializeApp(cleanConfig);
                window.db = getFirestore(window.app);
                window.auth = getAuth(window.app);
                window.isFirebaseReady = true;

                // åœ¨ GitHub Pages ç’°å¢ƒä¸­ï¼Œæˆ‘å€‘åªåŸ·è¡ŒåŒ¿åç™»å…¥
                await signInAnonymously(window.auth);

                onAuthStateChanged(window.auth, (user) => {
                    if (user) {
                        window.currentUserId = user.uid;
                        document.getElementById('user-info').textContent = 'ç”¨æˆ¶ID: ' + user.uid.substring(0, 8) + '... (é›²ç«¯é€£ç·š)';
                    } else {
                        window.currentUserId = null;
                        document.getElementById('user-info').textContent = 'ç”¨æˆ¶ID: é€£ç·šå¤±æ•—';
                    }
                });

            } catch (error) {
                console.error("Firebase åˆå§‹åŒ–éŒ¯èª¤:", error);
                showNotification('Firebase åˆå§‹åŒ–å¤±æ•—ï¼Œé›²ç«¯å‚™ä»½ç„¡æ³•ä½¿ç”¨ã€‚', 'error');
                window.isFirebaseReady = false;
            }
        }

        // Expose Firebase functions to the global scope
        window.initializeFirebase = initializeFirebase;
        window.addDoc = addDoc;
        window.collection = collection;
        window.serverTimestamp = serverTimestamp;

    </script>
    <style>
        /* Custom font and basic styling */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+TC:wght@400;700&display=swap');
        body {
            font-family: 'Noto Sans TC', 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        /* Custom scrollbar for aesthetic */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-thumb {
            background-color: #f97316; /* Orange-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-track {
            background: #ffeac7; /* Lighter Orange */
        }
    </style>
    <script>
        // --- APP DATA AND STATE ---
        const menuData = [
            // --- ç‚’é£¯é¡ (Fried Rice) ---
            { id: 'FR1', name: 'è‚‰çµ²ç‚’é£¯', price: 70, category: 'ç‚’é£¯é¡', description: 'ç¶“å…¸è‚‰çµ²ï¼Œç±³ç²’åˆ†æ˜' },
            { id: 'FR2', name: 'è¦ä»è›‹ç‚’é£¯', price: 80, category: 'ç‚’é£¯é¡', description: 'Qå½ˆè¦ä»ï¼Œé‡‘é»ƒè›‹èŠ±' },
            { id: 'FR3', name: 'é¦™è…¸ç‚’é£¯', price: 75, category: 'ç‚’é£¯é¡', description: 'å°å¼é¦™è…¸ï¼Œé¹¹é¦™å¤ å‘³' },
            { id: 'FR10', name: 'ç‰›è‚‰è›‹ç‚’é£¯', price: 85, category: 'ç‚’é£¯é¡', description: 'é®®å«©ç‰›è‚‰ï¼Œé¢¨å‘³æ¿ƒéƒ' },
            
            // --- è“‹é£¯/ç‡´é£¯ (Rice Bowls) ---
            { id: 'CR1', name: 'æ—¥å¼è±¬è‚‰è“‹é£¯', price: 90, category: 'è“‹é£¯/ç‡´é£¯', description: 'æ—¥å¼é†¬æ±ï¼Œæ»‘å«©è±¬è‚‰' },
            { id: 'CR5', name: 'å®®ä¿é›ä¸è“‹é£¯', price: 90, category: 'è“‹é£¯/ç‡´é£¯', description: 'é…é£¯é¦–é¸ï¼Œæ¿ƒéƒé†¬æ±' },
            { id: 'CR8', name: 'éº»å©†è±†è…è“‹é£¯', price: 90, category: 'è“‹é£¯/ç‡´é£¯', description: 'éº»è¾£é®®é¦™ï¼Œæ‹Œé£¯ä¸€æµ' },

            // --- ç²¾ç·»å¥—é¤ (Set Meals) ---
            { id: 'SM1', name: 'å®®ä¿é›ä¸å¥—é¤', price: 260, category: 'ç²¾ç·»å¥—é¤', description: 'ä¸»èœ+ç™½é£¯+ä¸‰æ¨£èœ' },
            { id: 'SM4', name: 'è”¥çˆ†ç‰›å¥—é¤', price: 270, category: 'ç²¾ç·»å¥—é¤', description: 'ä¸»èœ+ç™½é£¯+ä¸‰æ¨£èœ' },

            // --- éºµé¡ (Noodles) ---
            { id: 'N1', name: 'è‚‰çµ²ç‚’éºµ', price: 70, category: 'éºµé¡', description: 'ç¶“å…¸è‚‰çµ²ï¼Œå¤§ç«å¿«ç‚’' },
            { id: 'N7', name: 'æ²™èŒ¶ç‰›è‚‰ç‚’éºµ', price: 90, category: 'éºµé¡', description: 'æ²™èŒ¶é¢¨å‘³ï¼Œæ¿ƒéƒé¦™è¾£' },

            // --- é‹ç‡’éºµ/å†¬ç²‰/ç²¥ (Stir-fried Noodles/Vermicelli/Porridge) ---
            { id: 'P1', name: 'é‹ç‡’æ„éºµ', price: 80, category: 'é‹ç‡’é¡', description: 'æ„éºµQå½ˆï¼Œæ¹¯é ­é®®ç”œ' },
            { id: 'P5', name: 'é‹ç‡’æµ·é®®ç²¥', price: 80, category: 'é‹ç‡’é¡', description: 'é®®ç¾æµ·é®®ï¼Œç±³ç²’è»Ÿç³¯' },

            // --- é£¯é¡ (Rice) ---
            { id: 'R1', name: 'å®®ä¿é›ä¸é£¯', price: 75, category: 'é£¯é¡', description: 'ä¸‹é£¯å°ç‚’ï¼Œæ­é…ç™½é£¯' },
            { id: 'R6', name: 'è”¥çˆ†ç‰›è‚‰é£¯', price: 85, category: 'é£¯é¡', description: 'é®®å«©ç‰›è‚‰ï¼Œè”¥æ®µçˆ†é¦™' },

            // --- æ³¡èœé¡ (Pickled Cabbage) ---
            { id: 'K1', name: 'æ³¡èœè±¬è‚‰ç‚’é£¯', price: 80, category: 'æ³¡èœé¡', description: 'æ³¡èœé…¸è¾£ï¼Œæ­é…è±¬è‚‰' },
            { id: 'K7', name: 'æ³¡èœç‰›è‚‰ç‚’é£¯', price: 90, category: 'æ³¡èœé¡', description: 'æ³¡èœé…¸è¾£ï¼Œæ­é…ç‰›è‚‰' },
            
            // --- å–®é»å°ç‚’/è›‹é¡ (A La Carte/Eggs) ---
            { id: 'ALC1', name: 'æ™‚ä»¤é’èœ', price: 40, category: 'å–®é»å°ç‚’', description: 'ç•¶å­£æ–°é®®é’èœ' },
            { id: 'ALC3', name: 'è”¥èŠ±è›‹', price: 40, category: 'å–®é»å°ç‚’', description: 'é‡‘é»ƒè”¥èŠ±ï¼Œé¦™æ°£æ¿ƒéƒ' },
            { id: 'ALC11', name: 'å®®ä¿é›ä¸', price: 75, category: 'å–®é»å°ç‚’', description: 'é¦™è¾£å¾®ç”œ' },
            { id: 'ALC19', name: 'é’æ¤’ç‰›è‚‰', price: 90, category: 'å–®é»å°ç‚’', description: 'é‘Šæ°£åè¶³' },

            // --- æ¹¯é¡ (Soup) ---
            { id: 'S1', name: 'å‘³å™Œè±†è…æ¹¯', price: 20, category: 'æ¹¯é¡', description: 'æ¸…æ·¡æ—¥å¼é¢¨å‘³' },
            { id: 'S6', name: 'è›¤ä»”æ¹¯', price: 30, category: 'æ¹¯é¡', description: 'åŸå‘³é®®ç”œ' },
        ];

        let cart = {}; // { itemId: { item, quantity } }

        // --- UTILITY FUNCTIONS ---

        /**
         * Displays a temporary notification message in the corner.
         * @param {string} message The message to display.
         * @param {string} type 'success' or 'error'
         */
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const color = type === 'success' ? 'bg-green-500' : 'bg-red-500';

            notification.textContent = message;
            notification.className = `fixed bottom-5 right-5 p-4 rounded-lg shadow-xl text-white transition-opacity duration-300 z-50 ${color}`;
            notification.classList.remove('opacity-0', 'hidden');
            notification.classList.add('opacity-100');

            setTimeout(() => {
                notification.classList.remove('opacity-100');
                notification.classList.add('opacity-0');
                setTimeout(() => notification.classList.add('hidden'), 300);
            }, 3000);
        }

        /**
         * Formats a number to currency string (NTD format).
         * @param {number} amount
         * @returns {string}
         */
        function formatCurrency(amount) {
            return '$' + amount.toLocaleString('zh-TW');
        }

        // --- CART LOGIC ---

        /**
         * Adds an item to the cart or increments its quantity.
         * @param {string} itemId The ID of the item to add.
         */
        function addToCart(itemId) {
            const item = menuData.find(i => i.id === itemId);
            if (!item) return;

            if (cart[itemId]) {
                cart[itemId].quantity += 1;
            } else {
                cart[itemId] = { ...item, quantity: 1 }; 
            }

            updateCartDisplay();
            showNotification(`${item.name} å·²åŠ å…¥è³¼ç‰©è»Š`, 'success');
        }

        /**
         * Decrements the quantity of an item or removes it if quantity reaches 0.
         * @param {string} itemId The ID of the item to remove.
         */
        function removeFromCart(itemId) {
            if (cart[itemId]) {
                cart[itemId].quantity -= 1;
                if (cart[itemId].quantity <= 0) {
                    delete cart[itemId];
                }
                updateCartDisplay();
            }
        }

        /**
         * Updates the cart badge count and total in the UI.
         */
        function updateCartDisplay() {
            const cartItems = Object.values(cart);
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            const totalAmount = cartItems.reduce((sum, item) => sum + item.quantity * item.price, 0);

            document.getElementById('cart-count').textContent = totalItems;
            document.getElementById('cart-total-amount').textContent = formatCurrency(totalAmount);

            // Update modal content if it's open
            renderCartModalContent();
        }

        /**
         * Renders the cart contents inside the modal.
         */
        function renderCartModalContent() {
            const cartList = document.getElementById('cart-list');
            const cartItems = Object.values(cart);

            let html = '';

            if (cartItems.length === 0) {
                html = '<p class="text-gray-500 text-center py-8">è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œå¿«å»é»é¤å§ï¼</p>';
                document.getElementById('checkout-button').disabled = true;
                document.getElementById('checkout-button').classList.add('opacity-50', 'cursor-not-allowed');
                document.getElementById('customer-input-container').classList.add('hidden'); // Hide input if cart is empty
            } else {
                document.getElementById('checkout-button').disabled = false;
                document.getElementById('checkout-button').classList.remove('opacity-50', 'cursor-not-allowed');
                document.getElementById('customer-input-container').classList.remove('hidden'); // Show input if cart has items

                cartItems.forEach(item => {
                    html += `
                        <div class="flex items-center justify-between p-4 border-b border-orange-100 last:border-b-0">
                            <div class="flex-1 min-w-0">
                                <p class="font-semibold text-lg text-gray-800 truncate">${item.name}</p>
                                <p class="text-orange-500">${formatCurrency(item.price)} x ${item.quantity} = ${formatCurrency(item.price * item.quantity)}</p>
                            </div>
                            <div class="flex items-center space-x-2 ml-4">
                                <button onclick="removeFromCart('${item.id}')" class="w-8 h-8 flex items-center justify-center bg-red-100 text-red-600 rounded-full hover:bg-red-200 transition duration-150 active:scale-95">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5 10a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                                <span class="font-bold text-gray-800 w-6 text-center">${item.quantity}</span>
                                <button onclick="addToCart('${item.id}')" class="w-8 h-8 flex items-center justify-center bg-orange-100 text-orange-600 rounded-full hover:bg-orange-200 transition duration-150 active:scale-95">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                });
            }

            cartList.innerHTML = html;
        }

        // --- ORDER SUBMISSION AND LINE INTEGRATION ---

        /**
         * Submits the current cart as a new order to Firestore and generates a LINE message.
         */
        async function submitOrder() {
            // 1. Get customer information from the modal input
            const customerName = document.getElementById('customer-name-input').value.trim();
            const customerNote = document.getElementById('customer-note-input').value.trim() || 'ç„¡';
            
            // 2. Basic Validation
            if (Object.keys(cart).length === 0) {
                showNotification('è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œç„¡æ³•é€å‡ºè¨‚å–®', 'error');
                return;
            }
            if (!customerName) {
                showNotification('è«‹è¼¸å…¥å§“åæˆ–æ¡Œè™Ÿ (å¿…å¡«æ¬„ä½)ï¼', 'error');
                document.getElementById('customer-name-input').focus();
                return;
            }

            const totalAmount = Object.values(cart).reduce((sum, item) => sum + item.quantity * item.price, 0);
            let docRefId = 'N/A (é›¢ç·šæ¨¡å¼)'; // Default ID before submission

            document.getElementById('loading-overlay').classList.remove('hidden');

            // 3. Firestore Submission (Record the order for history/backup)
            if (window.isFirebaseReady && window.db && window.currentUserId) {
                const orderData = {
                    userId: window.currentUserId,
                    appId: window.appId,
                    customerName: customerName,
                    customerNote: customerNote,
                    items: Object.values(cart).map(item => ({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        quantity: item.quantity,
                        subtotal: item.price * item.quantity
                    })),
                    totalAmount: totalAmount,
                    status: 'Pending', // å¾…è™•ç†
                    createdAt: window.serverTimestamp()
                };

                // Private collection path for orders: artifacts/{appId}/users/{userId}/orders
                // é€™è£¡çš„ appId æœƒä½¿ç”¨æ‚¨åœ¨ YOUR_FIREBASE_CONFIG ä¸­è¨­å®šçš„ projectId
                const path = `artifacts/${window.appId}/users/${window.currentUserId}/orders`;

                try {
                    const docRef = await window.addDoc(window.collection(window.db, path), orderData);
                    docRefId = docRef.id;
                    showNotification(`è¨‚å–®å·²å‚™ä»½è‡³é›²ç«¯ (ID: ${docRefId})`, 'success');

                } catch (e) {
                    console.error("Error adding document: ", e);
                    showNotification(`é›²ç«¯å‚™ä»½å¤±æ•—ï¼š${e.message}ã€‚è¨‚å–®å°‡é€é LINE å‚³é€ã€‚`, 'error');
                }
            } else {
                 showNotification(`é›²ç«¯å‚™ä»½å·²è·³é (é›¢ç·šæ¨¡å¼)ã€‚`, 'error');
            }


            // 4. Generate formatted message for LINE
            let messageText = `ã€çé¦™å°é¤¨ - æ–°è¨‚å–®ã€‘\n`;
            messageText += `==========================\n`;
            messageText += `ğŸ‘¤ è¨‚è³¼äºº/æ¡Œè™Ÿ: ${customerName}\n`;
            messageText += `ğŸ“ å‚™è¨»: ${customerNote}\n`;
            messageText += `--------------------------\n`;
            messageText += `ğŸ’° ç¸½é‡‘é¡: ${formatCurrency(totalAmount)}\n`;
            messageText += `ğŸ“œ è¨‚å–®è©³æƒ…:\n`;

            Object.values(cart).forEach(item => {
                messageText += ` > ${item.name} x ${item.quantity} (${formatCurrency(item.price * item.quantity)})\n`;
            });

            messageText += `--------------------------\n`;
            messageText += `(åƒè€ƒID: ${docRefId}) è«‹å‚³é€çµ¦ LINE ID: joe690130`;

            // 5. Create the LINE message URL
            const lineMessage = encodeURIComponent(messageText);
            const lineUrl = `https://line.me/R/share?text=${lineMessage}`;

            // Open the LINE link in a new window/tab for manual delivery
            window.open(lineUrl, '_blank');
            
            // 6. Reset UI and display success
            document.getElementById('customer-name-input').value = ''; 
            document.getElementById('customer-note-input').value = ''; 
            cart = {};
            updateCartDisplay();
            toggleCartModal(false);

            document.getElementById('loading-overlay').classList.add('hidden');
            showNotification(`è«‹åˆ‡æ›è‡³ LINE è¦–çª—æ‰‹å‹•å‚³é€è¨Šæ¯çµ¦ joe690130 å®Œæˆè¨‚è³¼ï¼`, 'success');
        }


        // --- UI RENDERING ---

        /**
         * Renders the menu items grouped by category.
         */
        function renderMenu() {
            const menuContainer = document.getElementById('menu-container');
            // Define display order for categories
            const categoryOrder = ['ç‚’é£¯é¡', 'è“‹é£¯/ç‡´é£¯', 'ç²¾ç·»å¥—é¤', 'éºµé¡', 'é‹ç‡’é¡', 'é£¯é¡', 'æ³¡èœé¡', 'å–®é»å°ç‚’', 'æ¹¯é¡'];
            const categories = categoryOrder.filter(c => menuData.some(item => item.category === c));
            let html = '';

            categories.forEach(category => {
                const items = menuData.filter(item => item.category === category);

                html += `
                    <div id="${category}" class="mt-8 pt-4 border-t border-orange-200">
                        <h2 class="text-3xl font-extrabold text-gray-800 mb-6 border-l-4 border-orange-500 pl-4">${category}</h2>
                        <!-- Responsive grid for menu items -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                `;

                items.forEach(item => {
                    html += `
                        <div class="bg-white rounded-xl p-4 shadow-md hover:shadow-lg transition duration-200 flex flex-col justify-between">
                            
                            <!-- Content Section -->
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-gray-800 mb-1">${item.name}</h3>
                                <p class="text-sm text-gray-500 mb-3">${item.description}</p>
                            </div>
                            
                            <!-- Price and Button Section -->
                            <div class="flex justify-between items-center mt-2 border-t pt-2">
                                <span class="text-2xl font-extrabold text-orange-600">${formatCurrency(item.price)}</span>
                                <button onclick="addToCart('${item.id}')"
                                    class="px-4 py-2 bg-orange-500 text-white font-semibold rounded-full shadow-md hover:bg-orange-600 transition duration-150 active:scale-95 flex items-center space-x-1 text-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                                    </svg>
                                    <span>é»é¤</span>
                                </button>
                            </div>
                        </div>
                    `;
                });

                html += '</div></div>';
            });

            menuContainer.innerHTML = html;
        }

        /**
         * Toggles the visibility of the cart modal.
         * @param {boolean} show Whether to show or hide the modal.
         */
        function toggleCartModal(show) {
            const modal = document.getElementById('cart-modal');
            if (show) {
                renderCartModalContent(); // Refresh content before showing
                modal.classList.remove('hidden');
                setTimeout(() => { // Add transition effect
                    modal.querySelector('.modal-content').classList.remove('opacity-0', 'translate-y-4');
                    modal.classList.add('bg-black', 'bg-opacity-50');
                }, 10);
            } else {
                modal.querySelector('.modal-content').classList.add('opacity-0', 'translate-y-4');
                modal.classList.remove('bg-black', 'bg-opacity-50');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
        }


        // --- INITIALIZATION ---
        window.onload = async () => {
            // 1. å˜—è©¦åˆå§‹åŒ– Firebase 
            await window.initializeFirebase();
            
            // 2. ç„¡è«– Firebase é€£ç·šæˆåŠŸèˆ‡å¦ï¼Œéƒ½å¼·åˆ¶é¡¯ç¤ºèœå–®
            renderMenu(); 
            
            // 3. ç¢ºä¿è³¼ç‰©è»Šæ•¸é‡æ­£ç¢ºé¡¯ç¤º
            updateCartDisplay();
        };

        // Expose functions globally for HTML event handlers
        window.addToCart = addToCart;
        window.removeFromCart = removeFromCart;
        window.toggleCartModal = toggleCartModal;
        window.submitOrder = submitOrder;
    </script>
</head>
<body class="min-h-screen">

    <!-- Header & Navigation -->
    <header class="sticky top-0 bg-white shadow-lg z-30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <h1 class="text-3xl font-extrabold text-orange-600 tracking-tight">
                çé¦™å°é¤¨
                <span class="text-sm text-gray-500 font-normal block">ç·šä¸Šé»é¤æœå‹™</span>
            </h1>

            <div class="flex items-center space-x-4">
                <!-- User ID Display (for debug/tracking) -->
                <span id="user-info" class="text-xs text-gray-500 hidden sm:block">è¼‰å…¥ç”¨æˆ¶ä¸­...</span>

                <!-- Shopping Cart Button -->
                <button onclick="toggleCartModal(true)"
                    class="relative p-3 bg-orange-500 rounded-full text-white shadow-xl hover:bg-orange-600 transition duration-150 active:scale-95">
                    <!-- Icon: Shopping Cart -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <!-- Cart Count Badge -->
                    <span id="cart-count" class="absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform bg-red-600 rounded-full">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content: Menu -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <p class="text-lg text-gray-600 mb-6 border-b pb-4">
            è«‹é»é¸æ‚¨æƒ³é»çš„å“é …ã€‚é»é¤å®Œæˆå¾Œï¼Œè«‹æ–¼çµå¸³é é¢å¡«å¯«å§“å/æ¡Œè™Ÿï¼Œä¸¦é»æ“Šé€å‡ºæŒ‰éˆ•ã€‚
        </p>

        <!-- Menu Container (Content rendered by JavaScript) -->
        <div id="menu-container">
            <!-- Loading message or initial content -->
            <div class="text-center py-20 text-gray-500">
                <p>èœå–®è¼‰å…¥ä¸­...</p>
                <div class="mt-4 animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto"></div>
            </div>
        </div>
    </main>

    <!-- Cart Modal (Checkout Pop-up) -->
    <div id="cart-modal" class="fixed inset-0 hidden z-40 transition-all duration-300" onclick="if(event.target.id === 'cart-modal') toggleCartModal(false)">
        <div class="flex items-center justify-center min-h-screen px-4 py-8">
            <!-- Modal Content -->
            <div class="modal-content bg-white w-full max-w-lg rounded-xl shadow-2xl transform transition-all duration-300 opacity-0 translate-y-4" role="dialog" aria-modal="true" aria-labelledby="modal-title">
                
                <!-- Modal Header -->
                <div class="flex justify-between items-center p-6 bg-orange-500 rounded-t-xl">
                    <h3 id="modal-title" class="text-2xl font-bold text-white">æ‚¨çš„è¨‚å–®</h3>
                    <button onclick="toggleCartModal(false)" class="text-white hover:text-orange-100 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <!-- Modal Body: Cart Items -->
                <div id="cart-list" class="max-h-96 overflow-y-auto divide-y divide-gray-100">
                    <!-- Cart items rendered here by JS -->
                </div>

                <!-- Customer Details Input -->
                <div id="customer-input-container" class="p-6 border-t border-gray-100 space-y-3 hidden">
                    <input type="text" id="customer-name-input" placeholder="è«‹è¼¸å…¥å§“å/æ¡Œè™Ÿ (å¿…å¡«)" required
                        class="w-full p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition" />
                    <textarea id="customer-note-input" placeholder="è¨‚å–®å‚™è¨» (ä¾‹ï¼šå°‘å†°ã€ä¸åŠ è”¥ã€æ‰“åŒ…)"
                        class="w-full p-3 border border-orange-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition h-20 resize-none"></textarea>
                </div>

                <!-- Modal Footer -->
                <div class="p-6 pt-0">
                    <div class="flex justify-between items-center text-2xl font-bold mb-4">
                        <span>ç¸½è¨ˆé‡‘é¡:</span>
                        <span id="cart-total-amount" class="text-orange-600">$0</span>
                    </div>
                    <!-- Checkout Button: Triggers Firestore save and LINE Share link generation -->
                    <button id="checkout-button" onclick="submitOrder()"
                        class="w-full py-3 bg-green-500 text-white font-bold rounded-lg shadow-lg hover:bg-green-600 transition duration-150 active:scale-[.99] disabled:opacity-50 disabled:cursor-not-allowed">
                        é€å‡ºè¨‚å–® & é€šçŸ¥ LINE ID: joe690130
                    </button>
                    <p class="text-center text-sm text-gray-500 mt-2">
                        **é€å‡ºå¾Œå°‡è·³å‡º LINE è¦–çª—ï¼Œè«‹é»æ“Šå‚³é€çµ¦ joe690130 å®Œæˆé€šçŸ¥**
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Notification Box -->
    <div id="notification" class="fixed bottom-5 right-5 p-4 rounded-lg shadow-xl text-white opacity-0 hidden z-50"></div>

    <!-- Global Loading Indicator -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-30 z-50 flex items-center justify-center hidden">
        <div class="bg-white p-6 rounded-lg shadow-2xl flex items-center space-x-3">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-orange-500"></div>
            <span class="text-gray-700 font-semibold">è¨‚å–®è™•ç†ä¸­ï¼Œè«‹ç¨å€™...</span>
        </div>
    </div>
</body>
</html>
